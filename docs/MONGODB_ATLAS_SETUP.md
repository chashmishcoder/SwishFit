# MongoDB Atlas Production Setup - Step-by-Step Guide

## üéØ Overview
This guide will walk you through setting up MongoDB Atlas for production use with the SwishFit application.

**Estimated Time:** 15-20 minutes

---

## ‚úÖ Step 1: Create MongoDB Atlas Account

1. **Go to MongoDB Atlas:**
   - Visit: https://www.mongodb.com/cloud/atlas
   - Click "Try Free" button

2. **Sign Up:**
   - Use Google/GitHub for quick signup (recommended)
   - Or sign up with email and password
   - Verify your email address

3. **Welcome Survey (Optional):**
   - You can skip or fill out the survey
   - Click "Finish" to continue

---

## ‚úÖ Step 2: Create Production Cluster

1. **Create Cluster:**
   - Click "Build a Database" or "Create" button
   - You'll see three options:
     - **Serverless** ($0.10/million reads)
     - **Dedicated** (Starts at $57/month)
     - **Shared** (FREE - M0 Sandbox) ‚Üê **SELECT THIS**

2. **Configure Cluster:**
   - **Cloud Provider:** Select **AWS** (recommended for reliability)
   - **Region:** Select closest to your target users:
     - For India: `Mumbai (ap-south-1)` ‚Üê **RECOMMENDED**
     - For Asia: `Singapore (ap-southeast-1)`
     - For US: `N. Virginia (us-east-1)`
     - For Europe: `Frankfurt (eu-central-1)`
   
3. **Cluster Tier:**
   - Should be auto-selected: **M0 Sandbox (Shared RAM, 512 MB Storage)**
   - This is FREE forever ‚úÖ

4. **Cluster Name:**
   - Change from "Cluster0" to: `swishfit-production`
   - Or keep default if you prefer

5. **Additional Settings:**
   - Leave MongoDB version as default (latest)
   - Backup: Enabled by default (cloud provider snapshots)

6. **Create Cluster:**
   - Click "Create" button
   - Wait 1-3 minutes for cluster to be created
   - You'll see "Cluster is being created..." message

---

## ‚úÖ Step 3: Configure Database Access (Create User)

1. **Security Quickstart:**
   - After cluster creation, you'll see "Security Quickstart"
   - Or go to: **Database Access** in left sidebar

2. **Add Database User:**
   - Click "Add New Database User" button

3. **Authentication Method:**
   - Select: **Password** (default)

4. **Create Credentials:**
   - **Username:** `swishfit_admin` (or your choice)
   - **Password:** 
     - Click "Autogenerate Secure Password" ‚Üê **RECOMMENDED**
     - **IMPORTANT:** Copy and save this password immediately!
     - Save it in a password manager or secure note
     - You'll need this for the connection string

5. **Database User Privileges:**
   - Select: **Read and write to any database**
   - This gives full access to all databases in the cluster

6. **Temporary User (Optional):**
   - Leave unchecked (we want permanent user)

7. **Add User:**
   - Click "Add User" button
   - User will be created immediately

**Save this information:**
```
Username: swishfit_admin
Password: [Your autogenerated password]
```

---

## ‚úÖ Step 4: Configure Network Access

1. **Go to Network Access:**
   - Click "Network Access" in left sidebar
   - Or it might show in Security Quickstart

2. **Add IP Address:**
   - Click "Add IP Address" button

3. **Configure Access:**
   - You'll see a popup with options:
   
   **Option A: Allow Access from Anywhere (RECOMMENDED for deployment)**
   - Click "Allow Access from Anywhere"
   - This adds `0.0.0.0/0` to whitelist
   - ‚ö†Ô∏è This is needed because deployment platforms (Render, Vercel) use dynamic IPs
   - MongoDB Atlas security still protects your database with username/password
   
   **Option B: Add Current IP Address**
   - Use this only for development/testing
   - Click "Add Current IP Address"
   - This whitelists only your current IP

4. **For Production: Use Option A**
   - Click "Allow Access from Anywhere"
   - Description: `Production - Allow all IPs (secured by username/password)`

5. **Confirm:**
   - Click "Confirm" button
   - Network rule will be active immediately

---

## ‚úÖ Step 5: Get Connection String

1. **Go to Database:**
   - Click "Database" in left sidebar
   - You should see your cluster: `swishfit-production`

2. **Connect to Cluster:**
   - Click "Connect" button on your cluster

3. **Choose Connection Method:**
   - Select: **"Connect your application"**
   - (Not "Compass" or "Shell")

4. **Select Driver and Version:**
   - **Driver:** Node.js
   - **Version:** 5.5 or later (or latest)

5. **Copy Connection String:**
   - You'll see a connection string like:
   ```
   mongodb+srv://swishfit_admin:<password>@swishfit-production.xxxxx.mongodb.net/?retryWrites=true&w=majority
   ```

6. **Modify Connection String:**
   - Replace `<password>` with your actual password (from Step 3)
   - Add database name `/swishfit` before the `?`:
   
   **Before:**
   ```
   mongodb+srv://swishfit_admin:<password>@swishfit-production.xxxxx.mongodb.net/?retryWrites=true&w=majority
   ```
   
   **After:**
   ```
   mongodb+srv://swishfit_admin:YOUR_ACTUAL_PASSWORD@swishfit-production.xxxxx.mongodb.net/swishfit?retryWrites=true&w=majority
   ```

7. **Save Connection String:**
   - Copy this modified connection string
   - Save it securely (you'll need it for deployment)

---

## ‚úÖ Step 6: Test Connection Locally

1. **Create .env file for testing:**
   ```bash
   cd /Users/omkarthorve/Desktop/Swishfit/backend
   ```

2. **Test the connection:**
   ```bash
   node scripts/testMongoAtlas.js
   ```
   
   The script will:
   - Test connection to MongoDB Atlas
   - Verify authentication works
   - Check if database is accessible
   - Create a test document
   - Clean up test data

3. **Expected Output:**
   ```
   ‚úÖ MongoDB Atlas Connected Successfully
   ‚úÖ Database is accessible
   ‚úÖ Authentication successful
   ‚úÖ Can write to database
   ‚úÖ Can read from database
   ‚úÖ Test data cleaned up
   
   Connection is ready for production!
   ```

---

## ‚úÖ Step 7: Verify Indexes (After First Deployment)

**Note:** Indexes are automatically created when the application runs. You can verify them after deploying.

1. **Using the verification script:**
   ```bash
   cd backend
   node scripts/verifyIndexes.js
   ```

2. **Or using MongoDB Atlas UI:**
   - Go to "Database" ‚Üí "Browse Collections"
   - Select collection (e.g., "users")
   - Click "Indexes" tab
   - Verify indexes exist

**Expected Indexes:**
- **users collection:**
  - `_id_` (default)
  - `email_1` (unique)
  - `role_1`
  - `coachId_1`
  
- **workouts collection:**
  - `_id_` (default)
  - `skillLevel_1_category_1`
  - `isPublic_1_isActive_1`
  
- **progresses collection:**
  - `_id_` (default)
  - `playerId_1_date_-1`
  - `workoutId_1`
  
- **leaderboards collection:**
  - `_id_` (default)
  - `rank_1`
  - `points_-1`

---

## ‚úÖ Step 8: Configure Automated Backups

**Good News:** MongoDB Atlas M0 (free tier) includes automated backups via cloud provider snapshots!

1. **Verify Backups:**
   - Go to your cluster
   - Click on "Backup" tab
   - You should see: "Cloud Provider Snapshots" enabled

2. **Backup Schedule (M0 Free Tier):**
   - Automatic snapshots by AWS/GCP/Azure
   - Retention: Limited (upgrade for more control)
   - Frequency: Continuous (cloud provider managed)

3. **Manual Snapshot (Optional):**
   - In "Backup" tab
   - Click "Take Snapshot Now"
   - Give it a name: `pre-production-snapshot`

4. **For Production (Future):**
   - Consider upgrading to M10+ for:
     - Continuous backups
     - Point-in-time restore
     - Longer retention periods
     - Download backup snapshots

---

## ‚úÖ Step 9: Monitor Database

1. **Database Metrics:**
   - Go to cluster ‚Üí "Metrics" tab
   - Monitor:
     - Connections
     - Network traffic
     - Operation execution times
     - Storage usage

2. **Set Up Alerts (Optional):**
   - Go to "Alerts" in left sidebar
   - Click "Add Alert"
   - Configure alerts for:
     - Connection limits
     - Storage usage (>80%)
     - CPU usage (>75%)

3. **Real-time Performance:**
   - Go to "Real-time Performance" tab
   - See slow queries
   - Monitor active connections

---

## üîí Security Best Practices

### ‚úÖ DO:
- ‚úÖ Use strong, autogenerated passwords
- ‚úÖ Store connection string securely (password manager)
- ‚úÖ Use environment variables (never hardcode)
- ‚úÖ Enable network access restrictions where possible
- ‚úÖ Regularly monitor access logs
- ‚úÖ Rotate passwords periodically (every 90 days)

### ‚ùå DON'T:
- ‚ùå Share connection string publicly
- ‚ùå Commit connection string to Git
- ‚ùå Use weak passwords
- ‚ùå Give unnecessary permissions
- ‚ùå Forget to monitor usage

---

## üìù Configuration Checklist

- [ ] MongoDB Atlas account created
- [ ] Production cluster created (M0 free tier)
- [ ] Region selected (closest to users)
- [ ] Database user created with strong password
- [ ] Username and password saved securely
- [ ] Network access configured (0.0.0.0/0)
- [ ] Connection string obtained
- [ ] Connection string modified with password and database name
- [ ] Connection tested locally (using test script)
- [ ] Connection string saved for deployment
- [ ] Automated backups verified
- [ ] Monitoring dashboard explored

---

## üéØ What's Next?

After completing this setup:

1. **Save Your Connection String:**
   ```
   mongodb+srv://swishfit_admin:YOUR_PASSWORD@swishfit-production.xxxxx.mongodb.net/swishfit?retryWrites=true&w=majority
   ```

2. **You'll use this connection string in:**
   - Render backend environment variables (`MONGODB_URI`)
   - Local production testing (`.env.production`)

3. **Next Task:**
   - Task 3: Backend Deployment to Render
   - You'll add this connection string to Render environment variables

---

## üÜò Troubleshooting

### Issue: Can't connect to cluster
**Solution:**
- Check network access includes 0.0.0.0/0
- Verify username/password are correct
- Check connection string has database name
- Wait 2-3 minutes after cluster creation

### Issue: Authentication failed
**Solution:**
- Verify password has no special characters (or URL encode them)
- Check username is exactly as created
- Ensure user has "Read and write" permissions

### Issue: Database not found
**Solution:**
- Make sure connection string includes `/swishfit` before `?`
- Database will be created automatically on first write

### Issue: Cluster creation failed
**Solution:**
- Try different region
- Clear browser cache
- Try different browser
- Contact MongoDB support

---

## üìû Support Resources

- **MongoDB Atlas Documentation:** https://www.mongodb.com/docs/atlas/
- **MongoDB University (Free Courses):** https://university.mongodb.com/
- **MongoDB Community Forums:** https://www.mongodb.com/community/forums/
- **Atlas Support:** https://support.mongodb.com/

---

**‚úÖ MongoDB Atlas Setup Complete!**

Once you've completed all steps and tested the connection, proceed to Task 3: Backend Deployment.

---

**Connection String Template (for reference):**
```
mongodb+srv://[USERNAME]:[PASSWORD]@[CLUSTER].mongodb.net/[DATABASE]?retryWrites=true&w=majority
```

**Your Connection String:**
```
mongodb+srv://swishfit_admin:YOUR_PASSWORD@swishfit-production.xxxxx.mongodb.net/swishfit?retryWrites=true&w=majority
```

Save this securely! üîê
